<script setup>
import { VForm } from "vuetify/components/VForm";
import {
  confirmedValidator,
  emailValidator,
  lengthValidator,
  passwordValidator,
  requiredValidator,
  urlValidator,
} from "@core/utils/validators";

const numberedSteps = [
  {
    title: "Account Details",
    subtitle: "Setup Account Details",
  },
  {
    title: "Personal Info",
    subtitle: "Add personal info",
  },
  {
    title: "Social Links",
    subtitle: "Add social links",
  },
];

const currentStep = ref(0);
const isPasswordVisible = ref(false);
const isCPasswordVisible = ref(false);
const isCurrentStepValid = ref(true);
const refAccountForm = ref();
const refPersonalForm = ref();
const refSocialLinkForm = ref();

const accountForm = ref({
  username: "",
  email: "",
  password: "",
  c_password: "",
});

const personalForm = ref({
  firstName: "",
  lastName: "",
  country: undefined,
  language: undefined,
});

const socialForm = ref({
  twitter: "",
  facebook: "",
  googlePlus: "",
  linkedIn: "",
});

const validateAccountForm = () => {
  refAccountForm.value?.validate().then((valid) => {
    if (valid.valid) {
      currentStep.value++;
      isCurrentStepValid.value = true;
    } else {
      isCurrentStepValid.value = false;
    }
  });
};

const validatePersonalForm = () => {
  refPersonalForm.value?.validate().then((valid) => {
    if (valid.valid) {
      currentStep.value++;
      isCurrentStepValid.value = true;
    } else {
      isCurrentStepValid.value = false;
    }
  });
};

const validateSocialLinkForm = () => {
  refSocialLinkForm.value?.validate().then((valid) => {
    if (valid.valid) {
      isCurrentStepValid.value = true;
      console.log({
        ...accountForm.value,
        ...personalForm.value,
        ...socialForm.value,
      });
    } else {
      isCurrentStepValid.value = false;
    }
  });
};
</script>

<template>
  <VCard>
    <VCardText>
      <!-- ðŸ‘‰ Stepper -->
      <AppStepper
        v-model:current-step="currentStep"
        :items="numberedSteps"
        align="start"
        :is-active-step-valid="isCurrentStepValid"
      />
    </VCardText>

    <VDivider />

    <VCardText>
      <!-- ðŸ‘‰ stepper content -->

      <VWindow v-model="currentStep" class="disable-tab-transition">
        <VWindowItem>
          <VForm ref="refAccountForm" @submit.prevent="validateAccountForm">
            <VRow>
              <VCol cols="12">
                <h6 class="text-sm font-weight-medium">Account Details</h6>
                <p class="text-xs mb-0">Enter your Account Details</p>
              </VCol>

              <VCol cols="12" md="6">
                <VTextField
                  v-model="accountForm.username"
                  placeholder="CarterLeonardo"
                  :rules="[
                    requiredValidator,
                    lengthValidator(accountForm.username, 6),
                  ]"
                  label="Username"
                />
              </VCol>

              <VCol cols="12" md="6">
                <VTextField
                  v-model="accountForm.email"
                  placeholder="carterleonardo@gmail.com"
                  :rules="[requiredValidator, emailValidator]"
                  label="Email"
                />
              </VCol>

              <VCol cols="12" md="6">
                <VTextField
                  v-model="accountForm.password"
                  label="Password"
                  placeholder="Enter Password"
                  :rules="[requiredValidator, passwordValidator]"
                  :type="isPasswordVisible ? 'text' : 'password'"
                  :append-inner-icon="
                    isPasswordVisible
                      ? 'mdi-eye-outline'
                      : 'mdi-eye-off-outline'
                  "
                  @click:append-inner="isPasswordVisible = !isPasswordVisible"
                />
              </VCol>

              <VCol cols="12" md="6">
                <VTextField
                  v-model="accountForm.c_password"
                  label="Confirm Password"
                  placeholder="Confirm Password"
                  :rules="[
                    requiredValidator,
                    confirmedValidator(
                      accountForm.c_password,
                      accountForm.password
                    ),
                  ]"
                  :type="isCPasswordVisible ? 'text' : 'password'"
                  :append-inner-icon="
                    isCPasswordVisible
                      ? 'mdi-eye-outline'
                      : 'mdi-eye-off-outline'
                  "
                  @click:append-inner="isCPasswordVisible = !isCPasswordVisible"
                />
              </VCol>

              <VCol cols="12">
                <div
                  class="d-flex justify-sm-space-between justify-center flex-wrap gap-4"
                >
                  <VBtn
                    :color="currentStep === 0 ? 'secondary' : 'default'"
                    variant="outlined"
                    disabled
                  >
                    <VIcon icon="mdi-arrow-left" start class="flip-in-rtl" />
                    Previous
                  </VBtn>

                  <VBtn type="submit">
                    Next
                    <VIcon icon="mdi-arrow-right" end class="flip-in-rtl" />
                  </VBtn>
                </div>
              </VCol>
            </VRow>
          </VForm>
        </VWindowItem>

        <VWindowItem>
          <VForm ref="refPersonalForm" @submit.prevent="validatePersonalForm">
            <VRow>
              <VCol cols="12">
                <h6 class="text-sm font-weight-medium">Personal Info</h6>
                <p class="text-xs mb-0">Setup Information</p>
              </VCol>

              <VCol cols="12" md="6">
                <VTextField
                  v-model="personalForm.firstName"
                  label="First Name"
                  :rules="[requiredValidator]"
                  placeholder="Leonard"
                />
              </VCol>

              <VCol cols="12" md="6">
                <VTextField
                  v-model="personalForm.lastName"
                  label="Last Name"
                  :rules="[requiredValidator]"
                  placeholder="Carter"
                />
              </VCol>

              <VCol cols="12" md="6">
                <VSelect
                  v-model="personalForm.country"
                  label="Country"
                  :rules="[requiredValidator]"
                  placeholder="Country"
                  :items="['UK', 'USA', 'Canada', 'Australia', 'Germany']"
                />
              </VCol>

              <VCol cols="12" md="6">
                <VSelect
                  v-model="personalForm.language"
                  label="Language"
                  :rules="[requiredValidator]"
                  placeholder="Language"
                  :items="['English', 'Spanish', 'French', 'Russian', 'German']"
                />
              </VCol>

              <VCol cols="12">
                <div class="d-flex justify-space-between">
                  <VBtn
                    color="secondary"
                    variant="tonal"
                    @click="currentStep--"
                  >
                    <VIcon icon="mdi-chevron-left" start class="flip-in-rtl" />
                    Previous
                  </VBtn>

                  <VBtn type="submit">
                    Next
                    <VIcon icon="mdi-chevron-right" end class="flip-in-rtl" />
                  </VBtn>
                </div>
              </VCol>
            </VRow>
          </VForm>
        </VWindowItem>

        <VWindowItem>
          <VForm
            ref="refSocialLinkForm"
            @submit.prevent="validateSocialLinkForm"
          >
            <VRow>
              <VCol cols="12">
                <h6 class="text-sm font-weight-medium">Social Links</h6>
                <p class="text-xs mb-0">Add Social Links</p>
              </VCol>

              <VCol cols="12" md="6">
                <VTextField
                  v-model="socialForm.twitter"
                  placeholder="https://twitter.com/abc"
                  :rules="[requiredValidator, urlValidator]"
                  label="Twitter"
                />
              </VCol>

              <VCol cols="12" md="6">
                <VTextField
                  v-model="socialForm.facebook"
                  placeholder="https://facebook.com/abc"
                  :rules="[requiredValidator, urlValidator]"
                  label="Facebook"
                />
              </VCol>

              <VCol cols="12" md="6">
                <VTextField
                  v-model="socialForm.googlePlus"
                  placeholder="https://plus.google.com/abc"
                  :rules="[requiredValidator, urlValidator]"
                  label="Google+"
                />
              </VCol>

              <VCol cols="12" md="6">
                <VTextField
                  v-model="socialForm.linkedIn"
                  placeholder="https://likedin.com/abc"
                  :rules="[requiredValidator, urlValidator]"
                  label="LinkedIn"
                />
              </VCol>

              <VCol cols="12">
                <div class="d-flex justify-space-between">
                  <VBtn
                    color="secondary"
                    variant="tonal"
                    @click="currentStep--"
                  >
                    <VIcon icon="mdi-chevron-left" start class="flip-in-rtl" />
                    Previous
                  </VBtn>

                  <VBtn color="primary" type="submit"> submit </VBtn>
                </div>
              </VCol>
            </VRow>
          </VForm>
        </VWindowItem>
      </VWindow>
    </VCardText>
  </VCard>
</template>
